<!DOCTYPE html>
<html lang=""><head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
        <title>Adventures in Dithering | Bruce Dawson</title>
        <meta name="description" content="Adventures in Dithering">
        <meta property="og:site_name" content="Adventures in Dithering" />
        <meta property="og:title" content="Bruce Dawson" />
        <meta property="og:description" content="Recently I had an opportunity to dive into the noisy world of dithering.
"/>
        <meta property="og:image" content="https://www.bruce.audio/img/bruce_cropped.png" />
				<meta name="keywords" content=""/>
    
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    
    <meta name="keywords" content="music technology, audio programming, DSP engineer, audio engineering, software developer">
    <link rel="icon" type="image/svg" href='https://www.bruce.audio/img/logo.png'/>
    <meta name="author" content='bruce_dawson'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.139.3">
    
    <link rel="stylesheet" href="https://www.bruce.audio/sass/main.min.a669fc379ca0ba4d389af69be2682407e7bca16d368f2e7ad5b83c0cd80029b3.css" type="text/css" media="screen" >

    <link rel="stylesheet" href="https://www.bruce.audio/css/style.css">

    

    
    </head>

<body>
      <div class="line" id="scrollIndicator"></div>
      <div class="main"><div class="title">
  <div class="name">
    <h2><a href="https://www.bruce.audio/"
	   style="text-decoration: none; color: inherit;">Bruce Dawson</a></h2>
  </div>
  <div class="color-scheme">
    <input type="checkbox" class="checkbox" id="chk" />
    <label class="label" for="chk">
						<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg>
						<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 160c-52.9 0-96 43.1-96
										96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"></path></svg>
      <div class="ball"></div>
    </label>
  </div>
</div>
<script>
  const themeSetter = (theme) => {
      document.body.classList.toggle('dark')
      localStorage.setItem('theme', theme)
      blockSwitcher()
  }

  const blockSwitcher = () => [...document.getElementsByTagName("BLOCKQUOTE")]
	.forEach(b => b.classList.toggle('dark'))

  const styleSwapper = () => {
      document.body.classList.add('back-transition')
      if (localStorage.getItem('theme') === 'dark') themeSetter('light')
      else if (localStorage.getItem('theme') === 'light') themeSetter('dark')
  }

  if (localStorage.getItem('theme') === 'dark'){
      themeSetter('dark')
      document.addEventListener("DOMContentLoaded", blockSwitcher)
  }
 else localStorage.setItem('theme', 'light')

  document.getElementById('chk').addEventListener('change',styleSwapper);

  window.addEventListener("scroll", () => {
      let height = document.documentElement.scrollHeight
          - document.documentElement.clientHeight;
      if(height >= 500){
	  let winScroll = document.body.scrollTop
              || document.documentElement.scrollTop;
	  let scrolled = (winScroll / height) * 100;
	  document.getElementById("scrollIndicator").style.width = scrolled + "%";
      }
  });
</script>

<section class="intro">
  
  <div class="post-header">
    <a class="go-back" href="https://www.bruce.audio/"><svg aria-hidden="true" focusable="false" data-prefix="far" class="back-icon" data-icon="caret-square-left" height="25px" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M272 157.1v197.8c0 10.7-13 16.1-20.5 8.5l-98.3-98.9c-4.7-4.7-4.7-12.2 0-16.9l98.3-98.9c7.5-7.7 20.5-2.3 20.5 8.4zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg> </a>
    <h2 class="post-title">Adventures in Dithering</h2>
</div>

<p class="post-dets">Published on: May 21, 2022
  | Reading Time: 5 min | Last Modified: May 21, 2022
  <br>
</p>
<span class="tags">
  
  <h5><a class="tag" href='https://www.bruce.audio/tags/audio'>audio</a></h5>
  
  <h5><a class="tag" href='https://www.bruce.audio/tags/signal%20processing'>signal processing</a></h5>
  
</span>

<div class="content">
  <p>Recently I had an opportunity to dive into the noisy world of dithering.</p>
<h2 id="what-is-dithering">What is Dithering?</h2>
<p>According to <a href="https://en.wikipedia.org/wiki/Dither">Wikipedia</a>, &ldquo;dither is an intentionally applied form of noise used to randomize quantization error, preventing large-scale patterns such as color banding in images.&rdquo; In the case of signal processing as pertains to audio, these patterns emerge as spectral <a href="https://en.wikipedia.org/wiki/Artifact_(error)">artifacts</a>, producing audible frequency content not found in the original audio source. Also according to Wikipedia, the word &ldquo;dither&rdquo; comes from the middle english verb &ldquo;didderen,&rdquo; meaning, &ldquo;to tremble.&rdquo; Dithering is the curious case where adding noise or &ldquo;tremble,&rdquo; to a signal provides more information &ndash; what a concept!</p>
<p>Earlier this year I was tasked with implementing a dithering algorithm at
<a href="https://output.com">Output</a>, which is an algorithm I had yet to previously implement. In software engineering, it seems to me that common problems arise and there&rsquo;s typically tried-and-true methods for solving these problems. In the case of dithering, this is also true, as there&rsquo;s a number of decent dithering algorithms available in closed-source software such as <a href="https://www.izotope.com/en/products/rx.html">Izotope RX</a>, or <a href="https://www.ableton.com/en/">Ableton Live</a>, some of which I had difficulty finding information about online. Thanks to organizations such as <a href="https://www.airwindows.com">Airwindows</a> and <a href="https://www.audacityteam.org">Audacity</a>, there are some open-source implementations available which allowed me to observe how some of these algorithms, such as how <a href="https://en.wikipedia.org/wiki/Triangular_distribution">Triangular Probability Density Function (TPDF)</a> dithering had been implemented by others.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="why-dithering">Why Dithering?</h2>
<p>Computers use what is known as an <a href="https://en.wikipedia.org/wiki/Analog-to-digital_converter">Analog-to-Digital Conversion (ADC)</a> process to convert analog audio signals to it&rsquo;s digital representation using what is known as the <a href="http://www.dspguide.com/ch3/2.htm">Sampling Theorem</a>. A sample is a slice of a continuous audio signal, and samples are played in sequence at <a href="https://www.izotope.com/en/learn/digital-audio-basics-sample-rate-and-bit-depth.html">sample rate</a> to form an audible signal. When sampled correctly, a continuous signal can be exactly reconstructed using its sampled equivalent. When sampling is performed incorrectly, such as when the frequency of the analog signal is greater than the <a href="Sampling" title="signal processing">Nyquist frequency</a> (one-half of the sampling rate), aliasing occurs where the frequency of the sampled data differs from the frequency of the original signal. Aliasing corrupts the sampled information causing the reconstruction of the original signal to be impossible.</p>
<p><em><strong>Note</strong>: the example images in this post are displayed using a <a href="https://en.wikipedia.org/wiki/Spectrogram">spectrogram</a> which displays the frequency content of an audio source. The &lsquo;Y&rsquo; axis of the image is frequency whereas the &lsquo;X&rsquo; axis is time.</em></p>
<h2 id="how-is-dithering-implemented">How is Dithering Implemented?</h2>
<p>Audio signals can be digitally represented as either an integer value within a <a href="https://en.wikipedia.org/wiki/Audio_bit_depth">signed bit range</a>, or as a floating-point value. In my case, I was dealing with floating-point values that I had to scale to their signed bit range value before adding noise to the audio signal. The number of possible integer values in the signed bit range can be calculated as:</p>
<pre tabindex="0"><code>2 ^ bitrate
</code></pre><p>with a range of:</p>
<pre tabindex="0"><code>bit = 2 ^ bitrate - 1

range = { -bit , bit - 1 }
</code></pre><p>In the case of 16-bit bitrate, the possible number of integer values is <strong>65,536</strong> with a range of <strong>-32,768 to 32,767</strong>.</p>
<p>Next, floating point noise is added to the audio signal in it&rsquo;s signed bit representation, resulting in modulation of the <a href="https://en.wikipedia.org/wiki/Bit_numbering">Least Significant Bit</a>, adding noise to the <a href="https://en.wikipedia.org/wiki/Noise_floor">noise floor</a>, eliminating quantization errors at the cost of a nearly imperceivable addition to the noise floor of the audio signal.</p>
<p>TPDF dithering involves the following calculation:</p>
<pre tabindex="0"><code>// range of &#39;rand&#39; is { -1.0, 1.0 }
(rand * rand) / N
</code></pre><p>which multiplies N number of random values in the floating-point signal range (-1.0 to 1.0), divided by N.</p>
<p><strong>Example of TPDF (silent audio source):</strong></p>


<img src="images/dither_tpdf.png" width="100%"/>


<p>However, noise-shaped TPDF Dithering takes a slightly different approach by tracking the previous random value and subtracting it from the current random value &ndash; this creates a &ldquo;shaped,&rdquo; effect which reduces the amount of noise distributed to the <a href="https://en.wikipedia.org/wiki/Frequency_band">middle frequency bands</a>.</p>
<pre tabindex="0"><code>rand = ( rand - previous_rand )
previous_rand = rand
</code></pre><p><strong>Example of noise-shaped dithering (silent audio source):</strong></p>


<img src="images/dither_shaped_tpdf.png" width="100%"/>


<p>While either dithering type is an acceptable choice, I have a preference for
noise-shaped dithering as it eliminates some noise in the mid-frequency band.
Other types of dithering such as Ableton Live&rsquo;s <strong>POW-r</strong> algorithm I have yet to explore, namely because I had difficulty finding information about these algorithms online. If you have experience implementing other types of dithering I&rsquo;d love to <a href="mailto:hi@bruce.audio?subject=Dithering">hear your experience</a>.</p>
<h2 id="the-results">The Results</h2>
<p>The difference between the dithered and non-dithered downsampled audio is evident when analyzed using a spectrogram. In the images below, the second example (no dithering) contains spectral artifacts on the right-hand side of the image, whereas the third image contains noise but no artifacts. The noise signal we&rsquo;ve added to our audio source safely negates quantization errors by replacing the silence with noise while being virtually imperceivable.</p>
<p><strong>Original audio file:</strong></p>


<img src="images/dither_original.png" width="100%"/>


<p><strong>Downsampled audio file without dithering (notice the artifacts):</strong></p>


<img src="images/dither_no_dither.png" width="100%"/>


<p><strong>Downsampled audio file with dithering (no artifacts):</strong></p>


<img src="images/dither_with_dither.png" width="100%"/>


<h2 id="conclusion">Conclusion</h2>
<p>The exploration of dithering was an exciting and challenging experience that aided me in growing a bit further in my skillset as an audio software engineer. While the implementation process wasn&rsquo;t as seamless as I had hoped due to some issues with low frequency content I had added to the signal in my initial attempts as a result of my incorrect calculations, this exploration helped me demystify the concept of dithering and further clarify my understanding of signal processing as pertains to audio bit depth, signed integer ranges, and bit modulation. I hope this blog post helps any reader that may be currently implementing their own dithering algorithm, may be curious as to how dithering works, or is simply interested in the work that I am doing.</p>
<p>Thanks for reading. Until next time, friends.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
</div>

</section>
<footer id="footer">
    <strong></strong>
    <div class="social">
        &nbsp; <a href="https://github.com/DawsonBruce" target="_blank" rel="noopener" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a> &nbsp;&nbsp; <a href="https://www.linkedin.com/in/bruce-dawson-75019a165/" target="_blank" rel="noopener" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a> &nbsp;&nbsp; <a href="mailto:hi@bruce.audio" target="_blank" rel="noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a> &nbsp;
    </div><strong></strong>
    <p style="color:grey;">Â© <script>document.write( new Date().getFullYear() );</script> Bruce Dawson.  <a href="https://creativecommons.org/licenses/by/4.0/">Some rights reserved</a>.</p>
</footer>
</div>
    </body>
</html>
